CREATE
DATABASE ACADEMIA
DEFAULT CHARACTER SET UTF8
DEFAULT COLLATE UTF8_GENERAL_CI;

USE ACADEMIA;
set sql_safe_updates =0;

CREATE TABLE PESSOA(
	CPF						VARCHAR(12) NOT NULL UNIQUE,
    ID						BOOL NOT NULL,
    NOME					VARCHAR(40) NOT NULL,
    SEXO					BOOL,
    FOTO					BLOB,
    SALDO_BANCARIO			DECIMAL(5,2) NOT NULL,
    
    PRIMARY KEY(ID,CPF)
)DEFAULT CHARSET UTF8;

CREATE TABLE ENDERECO(
	CPF						VARCHAR(12) NOT NULL UNIQUE,
    ID						BOOL NOT NULL,
	LOGRADOURO				VARCHAR(40) NOT NULL,
    BAIRRO					VARCHAR(20),
    CIDADE					VARCHAR(20),
    CEP						VARCHAR(9) NOT NULL,/*
    COORDENADA_LATITUDE		POINT,
    COORDENADA_LONGITUDE	POINT,*/
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET UTF8;

CREATE TABLE CADASTRO(
	CPF						VARCHAR(12) NOT NULL UNIQUE,
    ID						BOOL NOT NULL,
	EMAIL					VARCHAR(40) NOT NULL,
    SENHA					VARCHAR(20) NOT NULL,
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET UTF8;

CREATE TABLE TELEFONES( /* pra um projeto futuro, eu queria quebrar o numero em varias partes pra montar um mecanismo de verificacao mandando sms so no clique sobre o numero de telefone -duda */
	CPF						VARCHAR(12) NOT NULL,
    ID						BOOL NOT NULL,
    NUMERO					VARCHAR(15),
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET UTF8;

CREATE TABLE CLIENTE(
	CPF						VARCHAR(12) NOT NULL UNIQUE,
    ID						BOOL NOT NULL,
    METODO_PAGAMENTO		INT(8) NOT NULL, /*criar uma tabela para metodos de pagamento*/
    PESO					DECIMAL(4,2) NOT NULL,
    ALTURA					DECIMAL(3,2) NOT NULL,
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE/*
    FOREIGN KEY (METODO_PAGAMENTO) REFERENCES PAGAMENTOS(CODIGO_PAGAMENTO) ON DELETE CASCADE ON UPDATE CASCADE*/
)DEFAULT CHARSET UTF8;

CREATE TABLE FUNCIONARIO(
    CPF						VARCHAR(12) NOT NULL UNIQUE,
    ID						BOOL NOT NULL,
    ESPECIALIDADE			VARCHAR(31), /*vale criar uma tabela so pra listar na pesquisa*/
    TRABALHANDO				BOOL NOT NULL,
    METODO_RECEBIMENTO		INT(8) NOT NULL, /*acho que isso ja eh um relacionamento - e eh n:n*/
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE /*
    FOREIGN KEY (METODO_RECEBIMENTO) REFERENCES PAGAMENTOS(CODIGO_PAGAMENTO) ON DELETE CASCADE ON UPDATE CASCADE*/
)DEFAULT CHARSET UTF8; /* nao criei e nao testei pra ver se funciona */

CREATE TABLE CATEGORIA(
	CPF						VARCHAR(12) NOT NULL UNIQUE,
    ID						BOOL NOT NULL,
	VALOR_SESSAO			DECIMAL(4,2),
    REGIAO_TREINADA			VARCHAR(31),
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET UTF8; /* nao criei e nao testei pra ver se funciona */

CREATE TABLE REGIOES_CORPO(
	CPF						VARCHAR(12) NOT NULL UNIQUE,
    ID						BOOL NOT NULL,
	ABDOMEN					BOOL NOT NULL,
    PEITO					BOOL NOT NULL,
    BRACOS					BOOL NOT NULL,
    PERNAS					BOOL NOT NULL,
    OMBROS					BOOL NOT NULL,
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET UTF8; /* nao criei e nao testei pra ver se funciona */

CREATE TABLE PAGAMENTOS(
	CPF						VARCHAR(12) NOT NULL,
    ID						BOOL NOT NULL,
	CODIGO_PAGAMENTO		INT(8) NOT NULL, /* CARTAO_CREDITO,  codigo 0; CARTAO_DEBITO, codigo 1; PIX,  codigo 2 */
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET UTF8;

CREATE TABLE CARTAO_CREDITO(
	CPF						VARCHAR(12) NOT NULL,
    ID						BOOL NOT NULL,
	CODIGO_ID				INT(8) NOT NULL,
    NUMERO_CARTAO			VARCHAR(17),
    DATA_VALIDADE			DATE,
    CODIGO_SEGURANCA		BIGINT(255), /* conferir se isso aqui funciona */
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE /*
    FOREIGN KEY (CODIGO_ID) REFERENCES PAGAMENTOS(CODIGO_PAGAMENTO) ON DELETE CASCADE ON UPDATE CASCADE*/
)DEFAULT CHARSET UTF8; DROP TABLE CARTAO_CREDITO;

CREATE TABLE CARTAO_DEBITO(
	CPF						VARCHAR(12) NOT NULL,
    ID						BOOL NOT NULL,
	CODIGO_ID				INT(8) NOT NULL,
	BANCO					VARCHAR(20),
    AGENCIA					VARCHAR(5),
    NUMERO_CONTA			VARCHAR(17),
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE /*
    FOREIGN KEY (CODIGO_ID) REFERENCES PAGAMENTOS(CODIGO_PAGAMENTO) ON DELETE CASCADE ON UPDATE CASCADE */
)DEFAULT CHARSET UTF8;

CREATE TABLE PIX(
	CPF						VARCHAR(12) NOT NULL,
    ID						BOOL NOT NULL,
	CODIGO_ID				INT(8) NOT NULL,
	CHAVE_CADASTRADA		VARCHAR(40),
    
    FOREIGN KEY (ID,CPF) REFERENCES PESSOA(ID,CPF) ON DELETE CASCADE ON UPDATE CASCADE /*
    FOREIGN KEY (CODIGO_ID) REFERENCES PAGAMENTOS(CODIGO_PAGAMENTO) ON DELETE CASCADE ON UPDATE CASCADE */
)DEFAULT CHARSET UTF8;

ALTER TABLE PESSOA MODIFY SEXO varchar(10);
delete from PESSOA where cpf =05032888109;

DELIMITER $$
CREATE PROCEDURE `CARREGA_FUNCIONARIOS_ONLINE` (Categoria varchar(100))
BEGIN
SELECT CATEGORIA.VALOR_SESSAO, PESSOA.NOME, ENDERECO.LOGRADOURO, ENDERECO.BAIRRO, ENDERECO.CIDADE, TELEFONES.NUMERO, FUNCIONARIO.ESPECIALIDADE FROM PESSOA JOIN FUNCIONARIO ON PESSOA.CPF =FUNCIONARIO.cpf JOIN CATEGORIA ON CATEGORIA.CPF = PESSOA.CPF JOIN ENDERECO ON PESSOA.CPF = ENDERECO.CPF JOIN TELEFONES ON ENDERECO.CPF = TELEFONES.CPF WHERE FUNCIONARIO.TRABALHANDO =1;
END $$
DELIMITER ; CALL `CARREGA_FUNCIONARIOS_ONLINE`("MUU");

CREATE VIEW INFOS_LOGIN AS
SELECT ID,CPF,SENHA FROM CADASTRO;